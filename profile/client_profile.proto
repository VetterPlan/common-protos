syntax = "proto3";

package profile;

import "google/protobuf/timestamp.proto";

// ============================================================================
// CLIENT PROFILE SERVICE
// ============================================================================

service ClientProfileService {
  rpc CreateClientProfile (CreateClientProfileRequest) returns (ClientProfileResponse);
  rpc GetClientProfile (GetClientProfileRequest) returns (ClientProfileResponse);
  rpc UpdateClientProfile (UpdateClientProfileRequest) returns (ClientProfileResponse);
  rpc DeleteClientProfile (DeleteClientProfileRequest) returns (DeleteClientProfileResponse);

  // Multi-profile aggregation: returns both client and vet profile summaries
  rpc GetUserProfiles (GetUserProfilesRequest) returns (GetUserProfilesResponse);

  // ─── Avatar Upload ───
  // Generate a presigned URL for direct avatar upload to R2 storage
  rpc GenerateAvatarUploadUrl (GenerateAvatarUploadUrlRequest) returns (GenerateAvatarUploadUrlResponse);
}

// ============================================================================
// MESSAGES
// ============================================================================

message ClientProfile {
  string id = 1;
  string user_id = 2;
  
  // Basic Information
  string first_name = 3;
  string last_name = 4;
  string avatar_url = 5;
  
  // Personal Details
  string birthdate = 7;  // ISO 8601 date format: YYYY-MM-DD
  string gender = 8;
  
  // Localization
  string locale = 9;
  
  // Emergency Contact
  string emergency_contact_name = 11;
  string emergency_contact_phone = 12;
  
  // Preferences (JSON string)
  string preferences = 13;
  
  // Status
  bool is_completed = 14;
  
  // Timestamps
  google.protobuf.Timestamp created_at = 15;
  google.protobuf.Timestamp updated_at = 16;
}

message CreateClientProfileRequest {
  string user_id = 1;  // Required: user from auth-service

  // Optional initial data
  optional string first_name = 2;
  optional string last_name = 3;
  optional string birthdate = 4;
  optional string locale = 5;
  optional string gender = 6;
}

message GetClientProfileRequest {
  oneof identifier {
    string user_id = 1;
    string profile_id = 2;
  }
}

message UpdateClientProfileRequest {
  string user_id = 1;  // Required: identifies which profile to update

  // All fields optional - only provided fields will be updated
  optional string first_name = 2;
  optional string last_name = 3;
  optional string avatar_url = 4;
  optional string birthdate = 6;
  optional string gender = 7;
  optional string locale = 8;
  optional string emergency_contact_name = 10;
  optional string emergency_contact_phone = 11;
  optional string preferences = 12;  // JSON string
}

message DeleteClientProfileRequest {
  string user_id = 1;
}

message ClientProfileResponse {
  ClientProfile profile = 1;
}

message DeleteClientProfileResponse {
  bool success = 1;
  string message = 2;
}

// ============================================================================
// Multi-Profile Support (GetUserProfiles)
// ============================================================================

message GetUserProfilesRequest {
  string user_id = 1;
}

message GetUserProfilesResponse {
  UserProfiles profiles = 1;
}

message UserProfiles {
  string user_id = 1;
  optional ClientProfileSummary client_profile = 2;
  optional VetProfileSummary vet_profile = 3;
  repeated string roles = 4;
}

message ClientProfileSummary {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string avatar_url = 4;
  bool is_completed = 5;
}

message VetProfileSummary {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string avatar_url = 4;
  string professional_title = 5;
  string clinic_name = 6;
  bool is_completed = 7;
  string status = 8;
}

// ============================================================================
// AVATAR UPLOAD
// ============================================================================

message GenerateAvatarUploadUrlRequest {
  string file_extension = 1;    // e.g., "jpg", "png", "webp"
  string content_type = 2;      // e.g., "image/jpeg", "image/png"
}

message GenerateAvatarUploadUrlResponse {
  string upload_url = 1;        // Presigned PUT URL for direct upload to R2
  string file_url = 2;          // Public CDN URL (to save in avatar_url after upload)
}
