syntax = "proto3";

package profile;

import "google/protobuf/timestamp.proto";

// ============================================================================
// LEGACY PROFILE SERVICE
// ============================================================================
// This service will be deprecated once all clients migrate to:
// - ClientProfileService (client_profile.proto)
// - VetProfileService (vet_profile.proto)
//
// Deprecation Timeline:
// - Semana 1-2: Legacy endpoints work, new endpoints available
// - Semana 3-4: Warning logs on legacy endpoints
// - Semana 5-6: Frontend migrated to new endpoints
// - Semana 7+:  Remove legacy endpoints
// ============================================================================

service ProfileService {
  rpc CreateProfile (CreateProfileRequest) returns (ProfileResponse);
  rpc GetProfile (GetProfileRequest) returns (ProfileResponse);
  rpc UpdateProfile (UpdateProfileRequest) returns (ProfileResponse);
  
  // NEW: Multi-role support
  rpc GetUserProfiles (GetUserProfilesRequest) returns (GetUserProfilesResponse);
}

message Profile {
  string id = 1;
  string user_id = 2;

  string first_name = 3;
  string last_name = 4;
  string avatar_url = 5;

  string gender = 6;
  string birthdate = 7;

  string locale = 8;
  string timezone = 9;

  bool is_completed = 10;

  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

message CreateProfileRequest {
  string user_id = 1;
}

message GetProfileRequest {
  string user_id = 1;
}

message UpdateProfileRequest {
  string user_id = 1;

  optional string first_name = 2;
  optional string last_name = 3;
  optional string avatar_url = 4;
  optional string gender = 5;
  optional string birthdate = 6;
  optional string locale = 7;
  optional string timezone = 8;
}

message ProfileResponse {
  Profile profile = 1;
}

// ============================================================================
// NEW: Multi-Profile Support
// ============================================================================

message UserProfiles {
  string user_id = 1;
  
  // A user can have one or both profiles
  optional ClientProfileSummary client_profile = 2;
  optional VetProfileSummary vet_profile = 3;
  
  repeated string roles = 4;  // ["client", "vet", "admin"]
}

message ClientProfileSummary {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string avatar_url = 4;
  bool is_completed = 5;
}

message VetProfileSummary {
  string id = 1;
  string first_name = 2;
  string last_name = 3;
  string avatar_url = 4;
  string professional_title = 5;
  string clinic_name = 6;
  bool is_completed = 7;
  string status = 8;  // VetProfileStatus as string
}

message GetUserProfilesRequest {
  string user_id = 1;
}

message GetUserProfilesResponse {
  UserProfiles profiles = 1;
}
