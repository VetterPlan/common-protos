syntax = "proto3";

package profile;

import "google/protobuf/timestamp.proto";

// ============================================================================
// VET PROFILE SERVICE
// ============================================================================

service VetProfileService {
  rpc CreateVetProfile (CreateVetProfileRequest) returns (VetProfileResponse);
  rpc GetVetProfile (GetVetProfileRequest) returns (VetProfileResponse);
  rpc UpdateVetProfile (UpdateVetProfileRequest) returns (VetProfileResponse);
  rpc DeleteVetProfile (DeleteVetProfileRequest) returns (DeleteVetProfileResponse);
  rpc UpdateVetProfileStatus (UpdateVetProfileStatusRequest) returns (VetProfileResponse);

  // ─── Vet Service Pricing ───
  rpc SetServicePrice (SetServicePriceRequest) returns (ServicePriceResponse);
  rpc GetVetServicePrices (GetVetServicePricesRequest) returns (VetServicePricesResponse);
  rpc GetVetPriceForService (GetVetPriceForServiceRequest) returns (ServicePriceResponse);
  rpc RemoveServicePrice (RemoveServicePriceRequest) returns (RemoveServicePriceResponse);
  rpc GetVetsByService (GetVetsByServiceRequest) returns (VetsByServiceResponse);
}

// ============================================================================
// ENUMS
// ============================================================================

enum VetProfileStatus {
  VET_PROFILE_STATUS_UNSPECIFIED = 0;
  INCOMPLETE = 1;                 // Missing required information
  PENDING_VERIFICATION = 2;       // Ready for admin review
  ACTIVE = 3;                     // Verified and can practice
  SUSPENDED = 4;                  // Temporarily disabled
}

// ============================================================================
// MESSAGES
// ============================================================================

message VetProfile {
  string id = 1;
  string user_id = 2;
  
  // Basic Information
  string first_name = 3;
  string last_name = 4;
  string avatar_url = 5;
  
  // Professional Information
  string professional_title = 7;  // e.g., "DVM", "VMD"
  string bio = 8;
  string years_of_experience = 9;
  
  // Practice Information
  string clinic_name = 10;
  string clinic_phone = 11;
  string clinic_email = 12;
  
  // Specialties (declared by vet, NOT certified)
  // Certified specialties are in vet-certification-service
  repeated string declared_specialties = 13;
  
  // Languages spoken (ISO 639-1 codes)
  repeated string languages = 14;
  
  // Availability settings (JSON string)
  string availability_settings = 15;
  
  // Localization
  string locale = 16;
  
  // Status (profile completion, NOT certification)
  VetProfileStatus status = 18;
  
  // Completion status
  bool is_completed = 19;
  
  // Timestamps
  google.protobuf.Timestamp created_at = 20;
  google.protobuf.Timestamp updated_at = 21;
}

message CreateVetProfileRequest {
  string user_id = 1;  // Required: user from auth-service

  // Optional initial data
  optional string first_name = 2;
  optional string last_name = 3;
  optional string professional_title = 5;
  optional string clinic_name = 6;
  optional string locale = 7;
}

message GetVetProfileRequest {
  oneof identifier {
    string user_id = 1;
    string profile_id = 2;
  }
}

message UpdateVetProfileRequest {
  string user_id = 1;  // Required: identifies which profile to update

  // All fields optional - only provided fields will be updated
  optional string first_name = 2;
  optional string last_name = 3;
  optional string avatar_url = 4;
  optional string professional_title = 6;
  optional string bio = 7;
  optional string years_of_experience = 8;
  optional string clinic_name = 9;
  optional string clinic_phone = 10;
  optional string clinic_email = 11;
  repeated string declared_specialties = 12;  // Replaces existing list
  repeated string languages = 13;  // Replaces existing list
  optional string availability_settings = 14;  // JSON string
  optional string locale = 15;
}

message UpdateVetProfileStatusRequest {
  string user_id = 1;
  VetProfileStatus status = 2;
  optional string reason = 3;  // For audit trail
}

message DeleteVetProfileRequest {
  string user_id = 1;
}

message VetProfileResponse {
  VetProfile profile = 1;
}

message DeleteVetProfileResponse {
  bool success = 1;
  string message = 2;
}

// ============================================================================
// VET SERVICE PRICING
// ============================================================================

enum VetServiceType {
  VET_SERVICE_TYPE_UNSPECIFIED = 0;
  VET_SERVICE_TYPE_CONSULTATION = 1;
  VET_SERVICE_TYPE_VACCINATION = 2;
  VET_SERVICE_TYPE_DEWORMING = 3;
  VET_SERVICE_TYPE_FOLLOW_UP = 4;
  VET_SERVICE_TYPE_MEDICAL_CERTIFICATE = 5;
  VET_SERVICE_TYPE_ULTRASOUND = 6;
  VET_SERVICE_TYPE_ELECTROCARDIOGRAM = 7;
}

message ServicePrice {
  string id = 1;
  string vet_profile_id = 2;
  VetServiceType service_type = 3;
  double price = 4;
  bool is_active = 5;
  string notes = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

message SetServicePriceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
  double price = 3;
  string notes = 4;
}

message ServicePriceResponse {
  ServicePrice price = 1;
}

message GetVetServicePricesRequest {
  string vet_profile_id = 1;
}

message VetServicePricesResponse {
  repeated ServicePrice prices = 1;
}

message GetVetPriceForServiceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
}

message RemoveServicePriceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
}

message RemoveServicePriceResponse {
  bool success = 1;
  string message = 2;
}

message GetVetsByServiceRequest {
  VetServiceType service_type = 1;
}

message VetByService {
  string vet_profile_id = 1;
  double price = 2;
  string notes = 3;
  string display_name = 4;
}

message VetsByServiceResponse {
  repeated VetByService vets = 1;
  int32 total_count = 2;
}
