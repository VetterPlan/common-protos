syntax = "proto3";

package profile;

import "google/protobuf/timestamp.proto";

// ============================================================================
// VET PROFILE SERVICE
// ============================================================================

service VetProfileService {
  rpc CreateVetProfile (CreateVetProfileRequest) returns (VetProfileResponse);
  rpc GetVetProfile (GetVetProfileRequest) returns (VetProfileResponse);
  rpc UpdateVetProfile (UpdateVetProfileRequest) returns (VetProfileResponse);
  rpc DeleteVetProfile (DeleteVetProfileRequest) returns (DeleteVetProfileResponse);
  rpc UpdateVetProfileStatus (UpdateVetProfileStatusRequest) returns (VetProfileResponse);

  // ─── Vet Service Pricing ───
  rpc SetServicePrice (SetServicePriceRequest) returns (ServicePriceResponse);
  rpc GetVetServicePrices (GetVetServicePricesRequest) returns (VetServicePricesResponse);
  rpc GetVetPriceForService (GetVetPriceForServiceRequest) returns (ServicePriceResponse);
  rpc RemoveServicePrice (RemoveServicePriceRequest) returns (RemoveServicePriceResponse);
  rpc GetVetsByService (GetVetsByServiceRequest) returns (VetsByServiceResponse);

  // ─── Working Hours ───
  rpc SetWorkingHours (SetWorkingHoursRequest) returns (WorkingHoursResponse);
  rpc SetBulkWorkingHours (SetBulkWorkingHoursRequest) returns (BulkWorkingHoursResponse);
  rpc GetWorkingHours (GetWorkingHoursRequest) returns (BulkWorkingHoursResponse);
  rpc RemoveWorkingDay (RemoveWorkingDayRequest) returns (RemoveWorkingDayResponse);

  // ─── Time Off ───
  rpc AddTimeOff (AddTimeOffRequest) returns (TimeOffResponse);
  rpc GetTimeOff (GetTimeOffRequest) returns (TimeOffListResponse);
  rpc RemoveTimeOff (RemoveTimeOffRequest) returns (RemoveTimeOffResponse);

  // ─── Availability Check (inter-service, called by Appointment Service) ───
  rpc CheckVetAvailability (CheckVetAvailabilityRequest) returns (CheckVetAvailabilityResponse);
  rpc GetVetAvailableSlots (GetVetAvailableSlotsRequest) returns (VetAvailableSlotsResponse);
}

// ============================================================================
// ENUMS
// ============================================================================

enum VetProfileStatus {
  VET_PROFILE_STATUS_UNSPECIFIED = 0;
  INCOMPLETE = 1;                 // Missing required information
  PENDING_VERIFICATION = 2;       // Ready for admin review
  ACTIVE = 3;                     // Verified and can practice
  SUSPENDED = 4;                  // Temporarily disabled
}

// ============================================================================
// MESSAGES
// ============================================================================

message VetProfile {
  string id = 1;
  string user_id = 2;
  
  // Basic Information
  string first_name = 3;
  string last_name = 4;
  string avatar_url = 5;
  
  // Professional Information
  string professional_title = 7;  // e.g., "DVM", "VMD"
  string bio = 8;
  string years_of_experience = 9;
  
  // Practice Information
  string clinic_name = 10;
  string clinic_phone = 11;
  string clinic_email = 12;
  
  // Specialties (declared by vet, NOT certified)
  // Certified specialties are in vet-certification-service
  repeated string declared_specialties = 13;
  
  // Languages spoken (ISO 639-1 codes)
  repeated string languages = 14;
  
  // Availability settings (JSON string)
  string availability_settings = 15;
  
  // Localization
  string locale = 16;
  
  // Status (profile completion, NOT certification)
  VetProfileStatus status = 18;
  
  // Completion status
  bool is_completed = 19;
  
  // Timestamps
  google.protobuf.Timestamp created_at = 20;
  google.protobuf.Timestamp updated_at = 21;
}

message CreateVetProfileRequest {
  string user_id = 1;  // Required: user from auth-service

  // Optional initial data
  optional string first_name = 2;
  optional string last_name = 3;
  optional string professional_title = 5;
  optional string clinic_name = 6;
  optional string locale = 7;
}

message GetVetProfileRequest {
  oneof identifier {
    string user_id = 1;
    string profile_id = 2;
  }
}

message UpdateVetProfileRequest {
  string user_id = 1;  // Required: identifies which profile to update

  // All fields optional - only provided fields will be updated
  optional string first_name = 2;
  optional string last_name = 3;
  optional string avatar_url = 4;
  optional string professional_title = 6;
  optional string bio = 7;
  optional string years_of_experience = 8;
  optional string clinic_name = 9;
  optional string clinic_phone = 10;
  optional string clinic_email = 11;
  repeated string declared_specialties = 12;  // Replaces existing list
  repeated string languages = 13;  // Replaces existing list
  optional string availability_settings = 14;  // JSON string
  optional string locale = 15;
}

message UpdateVetProfileStatusRequest {
  string user_id = 1;
  VetProfileStatus status = 2;
  optional string reason = 3;  // For audit trail
}

message DeleteVetProfileRequest {
  string user_id = 1;
}

message VetProfileResponse {
  VetProfile profile = 1;
}

message DeleteVetProfileResponse {
  bool success = 1;
  string message = 2;
}

// ============================================================================
// VET SERVICE PRICING
// ============================================================================

enum VetServiceType {
  VET_SERVICE_TYPE_UNSPECIFIED = 0;
  VET_SERVICE_TYPE_CONSULTATION = 1;
  VET_SERVICE_TYPE_VACCINATION = 2;
  VET_SERVICE_TYPE_DEWORMING = 3;
  VET_SERVICE_TYPE_FOLLOW_UP = 4;
  VET_SERVICE_TYPE_MEDICAL_CERTIFICATE = 5;
  VET_SERVICE_TYPE_ULTRASOUND = 6;
  VET_SERVICE_TYPE_ELECTROCARDIOGRAM = 7;
}

message ServicePrice {
  string id = 1;
  string vet_profile_id = 2;
  VetServiceType service_type = 3;
  double price = 4;
  bool is_active = 5;
  string notes = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

message SetServicePriceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
  double price = 3;
  string notes = 4;
}

message ServicePriceResponse {
  ServicePrice price = 1;
}

message GetVetServicePricesRequest {
  string vet_profile_id = 1;
}

message VetServicePricesResponse {
  repeated ServicePrice prices = 1;
}

message GetVetPriceForServiceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
}

message RemoveServicePriceRequest {
  string vet_profile_id = 1;
  VetServiceType service_type = 2;
}

message RemoveServicePriceResponse {
  bool success = 1;
  string message = 2;
}

message GetVetsByServiceRequest {
  VetServiceType service_type = 1;
}

message VetByService {
  string vet_profile_id = 1;
  double price = 2;
  string notes = 3;
  string display_name = 4;
}

message VetsByServiceResponse {
  repeated VetByService vets = 1;
  int32 total_count = 2;
}

// ============================================================================
// WORKING HOURS
// ============================================================================

message WorkingHoursEntry {
  string id = 1;
  string vet_profile_id = 2;
  int32 day_of_week = 3;        // 0=Monday, 6=Sunday
  string start_time = 4;        // "08:00"
  string end_time = 5;          // "18:00"
  bool is_active = 6;
}

message SetWorkingHoursRequest {
  string vet_profile_id = 1;
  int32 day_of_week = 2;
  string start_time = 3;        // "08:00"
  string end_time = 4;          // "18:00"
}

message WorkingHoursResponse {
  bool success = 1;
  WorkingHoursEntry working_hours = 2;
  string error = 3;
}

message SetBulkWorkingHoursRequest {
  string vet_profile_id = 1;
  repeated SetWorkingHoursEntry entries = 2;
}

message SetWorkingHoursEntry {
  int32 day_of_week = 1;
  string start_time = 2;
  string end_time = 3;
}

message BulkWorkingHoursResponse {
  bool success = 1;
  repeated WorkingHoursEntry working_hours = 2;
  string error = 3;
}

message GetWorkingHoursRequest {
  string vet_profile_id = 1;
  bool active_only = 2;         // default true
}

message RemoveWorkingDayRequest {
  string vet_profile_id = 1;
  int32 day_of_week = 2;
}

message RemoveWorkingDayResponse {
  bool success = 1;
  string error = 2;
}

// ============================================================================
// TIME OFF
// ============================================================================

message TimeOffEntry {
  string id = 1;
  string vet_profile_id = 2;
  string start_datetime = 3;    // ISO 8601 UTC
  string end_datetime = 4;      // ISO 8601 UTC
  string reason = 5;
  string created_at = 6;
}

message AddTimeOffRequest {
  string vet_profile_id = 1;
  string start_datetime = 2;    // ISO 8601 UTC
  string end_datetime = 3;      // ISO 8601 UTC
  string reason = 4;
}

message TimeOffResponse {
  bool success = 1;
  TimeOffEntry time_off = 2;
  string error = 3;
}

message GetTimeOffRequest {
  string vet_profile_id = 1;
  bool upcoming_only = 2;       // default true
}

message TimeOffListResponse {
  repeated TimeOffEntry time_off = 1;
  int32 total_count = 2;
}

message RemoveTimeOffRequest {
  string vet_profile_id = 1;
  string time_off_id = 2;
}

message RemoveTimeOffResponse {
  bool success = 1;
  string error = 2;
}

// ============================================================================
// AVAILABILITY CHECK (inter-service)
// ============================================================================

message CheckVetAvailabilityRequest {
  string vet_profile_id = 1;
  string check_start = 2;       // ISO 8601 UTC — start of window to verify
  string check_end = 3;         // ISO 8601 UTC — end of window to verify
}

message CheckVetAvailabilityResponse {
  bool is_available = 1;        // true if within working_hours AND no time_off
  string unavailable_reason = 2; // "OUTSIDE_WORKING_HOURS" / "TIME_OFF" / ""
}

message GetVetAvailableSlotsRequest {
  string vet_profile_id = 1;
  string date = 2;              // "2026-02-15" — date to get slots for
}

message VetAvailableSlotsResponse {
  repeated TimeSlot available_slots = 1;
  string date = 2;
  string vet_profile_id = 3;
}

message TimeSlot {
  string start_time = 1;        // "08:00"
  string end_time = 2;          // "12:00"
}
